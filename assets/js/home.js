// Generated by CoffeeScript 1.4.0
(function() {

  $(function() {
    var Home;
    Home = (function() {

      function Home() {
        var _this = this;
        $("#forgotpasswordlink").click(function() {
          return _this.showForgotPassword();
        });
        $("#backToLogin").click(function() {
          return _this.hideForgotPassword();
        });
        $("#submitForgotPassword").click(function() {
          return _this.submitForgotPassword();
        });
        $("#loginForm").data("process-submit", function(data) {
          return _this.processLogin(data);
        });
      }

      Home.prototype.showLogin = function() {
        $("#loginBlock").css({
          position: 'absolute',
          top: $("#header").height() + 5,
          left: $("#signInButton").offset().left - $("#loginBlock").width() + 40
        }).fadeIn();
        $(document).on("click.login", function() {
          var target;
          target = event.target;
          if (target.id === "loginBlock" || target.id === "signInButton" || $(target).closest("#loginBlock")[0]) {
            return;
          }
          return $("#loginBlock").fadeOut();
        });
        return false;
      };

      Home.prototype.showForgotPassword = function() {
        $(".loginBlockWrapper > form:first").animate({
          left: -300
        });
        return $(".loginBlockWrapper > form:last").animate({
          left: -300
        });
      };

      Home.prototype.hideForgotPassword = function() {
        $(".loginBlockWrapper > form:first").animate({
          left: 0
        });
        return $(".loginBlockWrapper > form:last").animate({
          left: 0
        });
      };

      Home.prototype.submitForgotPassword = function() {
        var email;
        email = $("#forgotPasswordEmail").val();
        $("#forgotPasswordError")[0].className = "";
        $("#forgotPasswordError").html("Sending...");
        return $.post('/forgotpassword', {
          email: email
        }, function(data, status, xhr) {
          if (data) {
            $("#forgotPasswordError")[0].className = "textSuccess";
            return $("#forgotPasswordError").html("New password has been sent to this email.");
          } else {
            $("#forgotPasswordError")[0].className = "textError";
            return $("#forgotPasswordError").html("We don't have this email.");
          }
        });
      };

      Home.prototype.processLogin = function(data) {
        $("#loginError").html("");
        if (data === "OK") {
          return window.location = "/";
        } else {
          $("#loginError")[0].className = "textError";
          return $("#loginError").html(data.message);
        }
      };

      return Home;

    })();
    return App.Home = new Home;
  });

}).call(this);
